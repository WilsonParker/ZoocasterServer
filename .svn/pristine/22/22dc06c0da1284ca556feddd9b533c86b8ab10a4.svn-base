<%@ page import="com.graction.lumi.util.format.*"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ page session="false" contentType="text/html; charset=UTF-8"%>
<%@ page import="java.util.*"%>
<%@ page import="java.util.stream.Stream"%>
<%@ page import="com.graction.lumi.data.*"%>
<%@ page import="com.graction.lumi.data.DataStorage.*"%>
<%@ page import="com.graction.lumi.model.response.*"%>
<%@ page import="com.graction.lumi.model.db.WeatherTable"%>
<%@ page import="com.graction.lumi.model.xml.weather.*"%>
<%
	// Map<String, Object> map = (Map<String, Object>) request.getAttribute(DataStorage.Attribute.ATTR_MAP);
	WeatherTable table = (WeatherTable) request.getAttribute(DataStorage.Attribute.ATTR_WEATHER_TABLE);
%>
<style>
td img {
	width: 45%;
	min-width: 350px;
}
</style>
<div class="card mb-3">
	<div class="card-header">
		<i class="fa fa-table"></i> Weather Information
	</div>
	<div class="card-body">
		<div class="table-responsive">
			<form id="frm" method="post" enctype="multipart/form-data">
			<table class="table table-bordered dataTable " width="100%"
				cellspacing="0" role="grid" aria-describedby="dataTable_info"
				style="width: 100%;">

				<tr>
					<td><%=DataStorage.Database.COLUMN_WEATHER_CODE%></td>
					<td><%=table.getWeather_code()%></td>
				</tr>
				<tr>
					<td><%=DataStorage.Database.COLUMN_WEATHER_NAME%></td>
					<td><%=table.getWeather_name()%></td>
				</tr>
				<%-- <tr>
					<td><%=DataStorage.Database.COLUMN_BACKGROUND_ROOT%></td>
					<td><%=table.getBackground_root()%></td>
				</tr> --%>
				<tr>
					<td><%=DataStorage.Database.COLUMN_BACKGROUND_PATH%></td>
					<td><%=table.getBackground_path()%></td>
				</tr>
				<tr>
					<td><%=DataStorage.Database.COLUMN_BACKGROUND_NAME%></td>
					<td><%=table.getBackground_name()%></td>
				</tr>
				<tr>
					<td>
						<%-- <input type="file" class="btn btn-default" name="<%=DataStorage.Param.PARAM_BACKGROUND_FILE%>"/> --%>
						<input type="file" class="btn btn-default" name="<%=DataStorage.Param.PARAM_BACKGROUND%>"/>
					</td>
					<td>
						<img class="img-thumbnail" src="<%=DataStorage.Server.PATH_UPLOAD_DIR + table.getBackground_path() + table.getBackground_name()%>" />	
					</td>
				</tr>
				<%-- <tr>
					<td><%=DataStorage.Database.COLUMN_CHARACTER_ROOT%></td>
					<td><%=table.getCharacter_root()%></td>
				</tr> --%>
				<tr>
					<td><%=DataStorage.Database.COLUMN_CHARACTER_PATH%></td>
					<td><%=table.getCharacter_path()%></td>
				</tr>
				<tr>
					<td><%=DataStorage.Database.COLUMN_CHARACTER_NAME%></td>
					<td><%=table.getCharacter_name()%></td>
				</tr>
				<tr>
					<td>
						<%-- <td><input type="file" class="btn btn-default" name="<%=DataStorage.Param.PARAM_CHARACTER_FILE%>" /> --%>
						<input type="file" class="btn btn-default" name="<%=DataStorage.Param.PARAM_CHARACTER%>">
					</td>
					<td>
						<img class="img-thumbnail" src="<%=DataStorage.Server.PATH_UPLOAD_DIR + table.getCharacter_path() + table.getCharacter_name()%>" />	
					</td>
				</tr>
				<%-- <tr>
					<td><%=DataStorage.Database.COLUMN_EFFECT_ROOT%></td>
					<td><%=table.getEffect_root()%></td>
				</tr> --%>
				<tr>
					<td><%=DataStorage.Database.COLUMN_EFFECT_PATH%></td>
					<td><%=table.getEffect_path()%></td>
				</tr>
				<tr>
					<td><%=DataStorage.Database.COLUMN_BACKGROUND_NAME%></td>
					<td><%=table.getEffect_name()%></td>
				</tr>
				<tr>
					<td>
						<%-- <input type="file" class="btn btn-default" name="<%=DataStorage.Param.PARAM_EFFECT_FILE%>" /> --%>
						<input type="file" class="btn btn-default" name="<%=DataStorage.Param.PARAM_EFFECT%>" />
					</td>
					<td>
						<img class="img-thumbnail" src="<%=DataStorage.Server.PATH_UPLOAD_DIR + table.getEffect_path() + table.getEffect_name()%>" />
					</td>
				</tr>
			</table>
			</form>
		</div>
		<button type="button" class="btn btn-default"
			onclick="javascript:window.history.back();">Back</button>
		<button type="button" class="btn btn-success" onclick="uploadImage()">Confirm</button>
	</div>
</div>
<script src="<%=DataStorage.Path.PATH_DIR_JS%>jquery-3.2.1.min.js"></script>
<script>
	function uploadImage(){
		var frmFile = new FormData(document.getElementById('frm'));
		<%-- frmFile.append("<%=DataStorage.Param.PARAM_BACKGROUND_PATH%>", "<%=table.getBackground_path()%>");
		frmFile.append("<%=DataStorage.Param.PARAM_CHARACTER_PATH%>", "<%=table.getCharacter_path()%>");
		frmFile.append("<%=DataStorage.Param.PARAM_EFFECT_PATH%>", "<%=table.getEffect_path()%>"); --%>
		frmFile.append("<%=DataStorage.Param.PARAM_BACKGROUND_INDEX%>", "<%=table.getBackground_index()+Param.PARAM_DELIMITER%>");
		frmFile.append("<%=DataStorage.Param.PARAM_CHARACTER_INDEX%>", "<%=table.getCharcater_index()%>");
		frmFile.append("<%=DataStorage.Param.PARAM_EFFECT_INDEX%>", "<%=table.getEffect_index()%>");
		/* var frmPath = $("#frm_path").serialize(); */
		/* var queryString = $("form[name=frm]").serialize(); */
		$.ajax({
			url : "<%=request.getContextPath()+DataStorage.Mapping.weatherDetailupload%>",
			type : "POST",
			processData: false,
            contentType: false,
			data : frmFile,
			success : function(result){
				console.log(result);
				switch(result){
				case <%=Code.CODE_SUCCESS%> :
					console.log("success");
					break;
				case <%=Code.CODE_FAIL%> :
					console.log("fail");
					break;
				}
			},
			error : function(xhr, status, error){
				console.log(error);
			}
		});
	}
</script>